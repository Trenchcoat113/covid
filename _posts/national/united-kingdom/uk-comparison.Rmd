---
title: "Comparing Rt by data source in the UK"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Using Rt to explore transmission in vulnerable populations 
We calculate Rt as the average of how many new infections arise from one infected person. But who is the "average" infected person? We only measure a Covid-19 infection when someone gets tested, admitted to hospital, or dies after disease has been confirmed. However, none of these data sources is truly representative of all the infections that have occurred. For example, patients in hospital are more likely to be vulnerable to severe disease (e.g. older or immunocompromised), compared to the average in the general population. This means that each data source represents a slightly different type of "average" person who has been infected.

We can use this feature of each data source to explore how transmission is spreading in different parts of the population. For example, in the UK in August, most new infections were spread between young people, typically less vulnerable to severe disease. This meant the Rt from all test-positive cases rose quicker over that period than the Rt calculated from patients in hospital. 

By tracking these comparisons, we can understand how Covid-19 is affecting the most vulnerable populations. To see this more clearly, we plot and compare Rt estimates from each data source.

To explore in more depth how Rt from different data sources can be used to understand transmission dynamics across the population, see our pre-print (currently in peer-review) [here](https://doi.org/10.1101/2020.10.18.20214585).


```{r, fig.dim=c(10,20), echo=FALSE}
library(magrittr)
summary <-  suppressMessages(readr::read_csv("https://raw.githubusercontent.com/epiforecasts/covid-rt-estimates/master/subnational/united-kingdom/collated/rt/summary_latest.csv")) %>%
  dplyr::mutate('Data source' = dplyr::recode_factor(source, 
                                                     "cases" = "Test-positives",
                                                     "admissions" = "Hospital admissions",
                                                     "deaths" = "Deaths"))
colours <- c("Test-positives" = "#1b9e77","Hospital admissions" =  "#7570b3","Deaths" = "#d95f02")
region_names <- factor(c("England", "Scotland", "Wales", "Northern Ireland",
                  "North East and Yorkshire", "North West", "Midlands", "East of England", 
                  "London", "South East", "South West"), ordered = TRUE)
# Plot
plot_rt_fn <- function(region_name){
  summary %>%
    dplyr::filter(region %in% region_name) %>%
    ggplot2::ggplot(ggplot2::aes(x = date, col = `Data source`, fill = `Data source`)) +
    ggplot2::geom_ribbon(ggplot2::aes(ymin = lower_50, ymax = upper_50),
                alpha = 0.2, size = 0, colour = NA) +
    ggplot2::geom_ribbon(ggplot2::aes(ymin = lower_90, ymax = upper_90),
                alpha = 0.1, colour = NA) +
    ggplot2::geom_line(ggplot2::aes(y = median),
              alpha = 0.9, size = 1) +
    ggplot2::geom_hline(yintercept = 1, linetype = 2) +
    ggplot2::scale_color_manual(values = colours) +
    ggplot2::scale_fill_manual(values = colours) +
    ggplot2::scale_x_date(date_breaks = "1 week", date_labels = "%b %d") +
    cowplot::theme_cowplot() +
    ggplot2::labs(y = "R(t)", x = NULL, subtitle = region_name) +
    ggplot2::theme(legend.position = "bottom",
          axis.text.x = ggplot2::element_text(angle = 45, hjust = 1)) +
    ggplot2::guides(colour = ggplot2::guide_legend(override.aes = list(alpha = 1)))
}
region_plot_rt <- purrr::map(region_names,
                             ~ plot_rt_fn(region_name = .x))
# # Plot selected regions:
library(patchwork)
region_plot_rt[[1]] +
  region_plot_rt[[2]] +
  region_plot_rt[[3]] +
  region_plot_rt[[4]] +
  region_plot_rt[[5]] +
  region_plot_rt[[6]] +
  region_plot_rt[[7]] +
  region_plot_rt[[8]] +
  region_plot_rt[[9]] +
  region_plot_rt[[10]] +
  region_plot_rt[[11]] +
  patchwork::plot_layout(ncol = 1, guides = "collect") &
  ggplot2::theme(legend.position = "bottom")

```

*Estimates of Rt (median, with 50% (darker shade) and 90% (lightest shade) credible interval), derived from data sources including all test-positive cases, hospital admissions, and deaths with a positive test in the previous 28 days.*
